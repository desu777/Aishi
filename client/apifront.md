# Frontend API Interaction Documentation (`client/apifront.md`)

This document outlines how the frontend client interacts with the various backend APIs and services, as defined in `client/apiflow.md` and based on the frontend structure in `client.md`.

## General Interaction Patterns

1.  **HTTP API Calls**:
    *   The client primarily uses `fetch` or a library like `axios` to make HTTP requests (GET, POST, etc.) to the `server/` and `lf0gfactory/` APIs.
    *   The base URL for the main server API is typically `process.env.REACT_APP_API_URL`.
    *   The base URL for the `lf0gfactory/` service is `process.env.REACT_APP_FACTORY_API_URL` (assumption, needs verification).
    *   Requests requiring authorization (e.g., posting comments, ratings) include a `walletAddress` and a `signature` generated by the user's connected wallet, as specified in `apiflow.md`.

2.  **WebSocket for Real-time Updates**:
    *   The client connects to the `transaction-broadcast-service/` via Socket.IO (likely on `process.env.REACT_APP_BROADCAST_URL` - assumption, needs verification).
    *   **Global Events (listened by client):**
        *   `new_transaction`: Receives new transactions broadcasted globally. Used for live feeds/tickers.
        *   `new_pool`: Receives data about newly created pools. Used for live updates on pool lists.
        *   `price_change_update`: Receives global price change updates for various pools.
        *   `recent_transactions`: On connection, receives a list of recent global transactions.
        *   `recent_pools`: On connection, receives a list of recent global pool creations.
    *   **Pool-Specific Events (listened by client after subscription):**
        *   `pool_data_update`: After subscribing to a pool (`subscribe_pool` event), receives full data snapshots for that pool.
        *   `pool_transaction_update`: After subscribing, receives individual new transactions for that specific pool.
    *   **Client Emitted Events (to `transaction-broadcast-service/`):**
        *   `subscribe_pool (data: { address: string })`: Client subscribes to a specific pool room.
        *   `unsubscribe_pool (data: { address: string })`: Client unsubscribes from a pool room.
        *   The client *might* also emit `broadcast_transaction`, `broadcast_pool`, or `broadcast_price_change` if it's designed to initiate such broadcasts, though these are more commonly triggered by backend services posting to the broadcast service's HTTP endpoints.

## Page/Component Specific API Interactions

### 1. HomePage (`client/src/pages/HomePage.js`)

*   **`TrendingPools` Component:**
    *   **API Call:** `GET /api/pools/trending` (from `server/`)
    *   **Purpose:** To fetch and display a list of currently trending pools.
    *   **Data Flow:** Receives a list of pool objects.
*   **`PoolsTicker` Component:**
    *   **WebSocket:** Listens to `new_transaction` and `price_change_update` from `transaction-broadcast-service/`.
    *   **Purpose:** To display a live ticker of pool prices or recent activity.
    *   **Data Flow:** Receives individual transaction objects or price change data objects.
    *   **Alternative/Fallback:** Could periodically fetch data from a general pool endpoint if WebSocket is not the primary source for the ticker's aggregate data.

### 2. Create Token Page (`client/src/pages/CreateToken.js`, `CreateTokenForm.js`)

*   **Form Submission (`SubmitSection`):**
    *   **Primary API Call:** `POST /create-token` (to `lf0gfactory/`)
    *   **Purpose:** To submit token creation details (name, symbol, description, creatorAddress) to the factory service.
    *   **Data Flow (Request):**
        ```json
        {
          "name": "string",
          "symbol": "string",
          "description": "string", // optional
          "creatorAddress": "string" // User's wallet address
        }
        ```
    *   **Data Flow (Response):** Receives success status with transaction hash, token address, etc.
    *   **Secondary API Call (after successful token creation for pool registration):** `POST /` (to `/api/pools` on `server/`)
    *   **Purpose:** To register the newly created token as a pool on the main platform, including uploading the token image.
    *   **Data Flow (Request):** Multipart/form-data including:
        *   `image`: (File) Token logo.
        *   Other pool data derived from the token creation (e.g., `name`, `symbol`, `contractAddress` (from factory response), `creatorAddress`).
    *   **Data Flow (Response):** Created pool object.
*   **NSFW Detection (`useNSFWDetection` hook):**
    *   Likely involves an external API call if image NSFW detection is client-side before upload, or this hook prepares data for a backend check. (Not specified in `apiflow.md`, assumed to be an external service or handled implicitly).

### 3. My Tokens Page (`client/src/pages/MyTokensPage.js`)

*   **Fetching User's Created Tokens:**
    *   **API Call:** `GET /api/pools/creator/:address` (from `server/`) where `:address` is the connected user's wallet address.
    *   **Purpose:** To display a list of all pools/tokens created by the current user.
    *   **Data Flow:** Receives a list of pool objects.

### 4. Pool Details Page (`client/src/pages/PoolDetailsPage/`)

*   **Initial Pool Data Load (`PoolDetailsPage.Logic.js`):**
    *   **API Call:** `GET /api/pools/:address` (from `server/`) where `:address` is the pool's contract address.
    *   **Purpose:** To fetch comprehensive details for a specific pool.
    *   **Data Flow:** Receives a detailed pool object.
*   **Price History (`PoolPriceChart` component):**
    *   **API Call:** `GET /api/pools/:address/price-history` (from `server/`)
    *   **Purpose:** To fetch historical price data for the pool's chart.
    *   **Data Flow:** Receives an array of price points.
*   **Holders Data (`TopHoldersList` component):**
    *   **API Call 1:** `GET /api/pools/:address/holders` (for summary/distribution)
    *   **API Call 2:** `GET /api/pools/:address/holders/list` (for a detailed list)
    *   **Purpose:** To display token holder information.
    *   **Data Flow:** Receives holder distribution data or a list of holder objects.
*   **Transaction History (`PoolTransactionHistory` component):**
    *   **Initial Load API Call:** `GET /api/transactions/pool/:address` (from `server/`)
    *   **Purpose (Initial):** To fetch a list of recent transactions for the pool.
    *   **Data Flow (Initial):** Receives a list of transaction objects.
    *   **Real-time Updates (WebSocket):**
        *   Client emits `subscribe_pool` with the pool's `address` to `transaction-broadcast-service/`.
        *   Listens to `pool_transaction_update` for single new transactions specific to this pool.
        *   Listens to `pool_data_update` for broader data refreshes for this pool (which might include an updated transaction list).
*   **Buy/Sell Actions on Bonding Curve (`PoolActionPanel` component):**
    *   **User Action:** User initiates a buy or sell.
    *   **Frontend Logic:** Calculates amounts, interacts with user's wallet for transaction signing (on-chain).
    *   **API Call (after on-chain transaction confirmation):** `POST /api/transactions` (to `server/`)
    *   **Purpose:** To record the buy/sell transaction in the backend database.
    *   **Data Flow (Request):** Transaction data object (e.g., type (buy/sell), amount, poolAddress, userAddress, tx_hash from blockchain).
    *   **Data Flow (Response):** Recorded transaction object.
    *   **WebSocket Broadcast:** This new transaction, once recorded, should be broadcasted by the backend via `transaction-broadcast-service/` (likely picked up by `pool_transaction_update` for this pool and `new_transaction` globally).
*   **Token Graduation (`GraduationModal` component):**
    *   **User Action:** Creator initiates graduation.
    *   **API Call:** `POST /api/pools/:address/graduate` (to `server/`)
    *   **Purpose:** To trigger the token graduation process. This might involve backend interaction with `lf0gfactory/api/claim-tokens` if the server manages this.
    *   **Data Flow (Request):** Path param `address` (token contract address). May require user's signature if not implicitly handled by session/role.
    *   **Data Flow (Response):** Status of the graduation process.
    *   After graduation, UI directs user to `swap.lf0g.fun`.
*   **Claiming Tokens (Potentially related to `MyTokensPage` or a dedicated creator dashboard if tokens are locked on `lf0gfactory`):**
    *   **API Call:** `POST /api/claim-tokens` (to `lf0gfactory/`)
    *   **Purpose:** For a token creator to claim unlocked tokens from the `BondingCurveToken` contract via the server.
    *   **Data Flow (Request):**
        ```json
        {
          "tokenAddress": "string", // Contract address of the BondingCurveToken
          "userAddress": "string"  // Wallet address to receive tokens (creator)
        }
        ```
    *   **Data Flow (Response):** Success status, transaction hashes, and amount claimed.
*   **Comments Section:**
    *   **View Comments:**
        *   **API Call:** `GET /api/comments/pool/:address` (from `server/`)
        *   **Data Flow:** Receives a list of comment objects.
    *   **Post Comment:**
        *   **API Call:** `POST /api/comments/pool/:address` (from `server/`)
        *   **Data Flow (Request):** `{ text: "string", walletAddress: "string", signature: "string" }`
        *   **Data Flow (Response):** Created comment object.
    *   **Like Comment:**
        *   **API Call:** `POST /api/comments/like/:id` (from `server/`) where `:id` is comment ID.
        *   **Data Flow (Request):** `{ walletAddress: "string", signature: "string" }`
        *   **Data Flow (Response):** Updated like count or status.
*   **Ratings Section:**
    *   **View Average Rating:**
        *   **API Call:** `GET /api/ratings/average/:poolId` (from `server/`)
        *   **Data Flow:** Receives average rating value.
    *   **View User's Rating:**
        *   **API Call:** `GET /api/ratings/user/:poolId/:walletAddress` (from `server/`)
        *   **Data Flow:** Receives the user's specific rating.
    *   **Post/Update Rating:**
        *   **API Call:** `POST /api/ratings` (from `server/`)
        *   **Data Flow (Request):** `{ poolId: "string", walletAddress: "string", ratingValue: number, signature: "string" }`
        *   **Data Flow (Response):** Status of submission or updated rating.

### 5. User Authentication (Used across various components/hooks like `useWallet`)

*   **Wallet Connection (`useWallet` hook):**
    *   Primarily interacts with browser wallet extensions (e.g., MetaMask).
    *   Once address is obtained, may call `GET /api/users/check/:address` (from `server/`) to see if user exists or to fetch basic profile info.
*   **Registration (if implemented with explicit user accounts beyond wallet address):**
    *   **API Call:** `POST /api/users/register` (from `server/`)
    *   **Data Flow (Request):** User details (e.g., `walletAddress`, potentially `username`, `password` if used).
*   **Login (if implemented):**
    *   **API Call:** `POST /api/users/login` (from `server/`)
    *   **Data Flow (Request):** Credentials.
*   **Re-authentication (if implemented for session refresh):**
    *   **API Call:** `POST /api/users/reauth` (from `server/`)

### 6. Leaderboard Page (`client/src/pages/LeaderboardPage.js`) (If Active)

*   **Fetching Leaderboard Data:**
    *   **API Call Option 1:** `GET /api/pools/top-gravity` (from `server/`)
    *   **API Call Option 2:** `GET /api/gravity-score/top?limit=<limit>` (from `server/`)
    *   **Purpose:** To display top pools based on Gravity Score or other ranking.
    *   **Data Flow:** Receives a list of pool objects.

### 7. Factory Info (Potentially for an admin/info page or during startup)

*   **API Call:** `GET /factory-info` (to `lf0gfactory/`)
*   **Purpose:** To retrieve details about the token factory contract and network.
*   **Data Flow (Response):** Receives factory address, total tokens created, network info.

---

This document provides a high-level overview. Specific implementation details (e.g., exact state management, error handling, loading states) within each component will further define these interactions. Environment variables for API base URLs need to be correctly configured in the client application.
